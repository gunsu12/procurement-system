services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    image: procurement-app:production
    container_name: procurement-app
    restart: always
    env_file:
      - .env
    working_dir: /var/www
    volumes:
      # Production: NO code mount (./:/var/www) for better performance and security
      # Only mount directory for persistence
      - ./storage:/var/www/storage
      - ./bootstrap/cache:/var/www/bootstrap/cache

      # Share public assets with Nginx
      # Docker copies the image's /var/www/public content to this volume on first creation
      - public_data:/var/www/public
    networks:
      - app-network

  web:
    image: nginx:alpine
    container_name: procurement-web
    restart: always
    ports:
      # Expose on port 80 (Standard HTTP) or keep 9001 if you have a proxy
      - "9001:80"
    volumes:
      # Read public files from shared volume (provided by app)
      - public_data:/var/www/public

      # Allow Nginx to read storage files (symlinked from public/storage)
      - ./storage:/var/www/storage

      # Nginx Configuration
      - ./docker/nginx/laravel.conf:/etc/nginx/conf.d/default.conf
    networks:
      - app-network
    depends_on:
      - app

networks:
  app-network:
    driver: bridge

volumes:
  public_data:
